<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Config Test - Nrome</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #28a745; }
        .error { background: #dc3545; }
        .warning { background: #ffc107; color: #000; }
        pre { background: #2d2d2d; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Nrome Configuration Diagnostic</h1>
    
    <!-- Local development config loader (silent fail if file doesn't exist) -->
    <script>
        // Try to load config.local.js for local development
        (function() {
            const script = document.createElement('script');
            script.src = 'config.local.js';
            script.onerror = function() {
                console.log('Running in production mode (config.local.js not found)');
            };
            document.head.appendChild(script);
        })();
    </script>
    <!-- Production config will be injected here by GitHub Actions -->
    <!-- PRODUCTION_CONFIG_PLACEHOLDER -->
    
    <div id="results"></div>
    
    <script>
        setTimeout(() => {
            const results = document.getElementById('results');
            let html = '<h2>Configuration Status:</h2>';
            
            // Check if LOCAL_CONFIG exists
            if (typeof window.LOCAL_CONFIG !== 'undefined') {
                html += '<div class="status success">‚úÖ window.LOCAL_CONFIG is defined</div>';
                html += '<pre>' + JSON.stringify(window.LOCAL_CONFIG, (key, value) => {
                    if (key === 'SUPABASE_ANON_KEY') return value.substring(0, 20) + '...' + value.substring(value.length - 10);
                    return value;
                }, 2) + '</pre>';
                
                // Check each property
                if (window.LOCAL_CONFIG.SUPABASE_URL) {
                    const url = window.LOCAL_CONFIG.SUPABASE_URL;
                    if (url.startsWith('http')) {
                        html += '<div class="status success">‚úÖ SUPABASE_URL is valid: ' + url + '</div>';
                    } else {
                        html += '<div class="status error">‚ùå SUPABASE_URL is invalid: ' + url + '</div>';
                    }
                } else {
                    html += '<div class="status error">‚ùå SUPABASE_URL is missing</div>';
                }
                
                if (window.LOCAL_CONFIG.SUPABASE_ANON_KEY) {
                    const key = window.LOCAL_CONFIG.SUPABASE_ANON_KEY;
                    if (key.startsWith('eyJ')) {
                        html += '<div class="status success">‚úÖ SUPABASE_ANON_KEY looks valid (starts with eyJ...)</div>';
                    } else {
                        html += '<div class="status warning">‚ö†Ô∏è SUPABASE_ANON_KEY might be invalid (doesn\'t start with eyJ)</div>';
                    }
                } else {
                    html += '<div class="status error">‚ùå SUPABASE_ANON_KEY is missing</div>';
                }
                
                if (window.LOCAL_CONFIG.VERCEL_API_URL) {
                    html += '<div class="status success">‚úÖ VERCEL_API_URL: ' + window.LOCAL_CONFIG.VERCEL_API_URL + '</div>';
                } else {
                    html += '<div class="status warning">‚ö†Ô∏è VERCEL_API_URL is missing</div>';
                }
                
            } else {
                html += '<div class="status error">‚ùå window.LOCAL_CONFIG is NOT defined</div>';
                html += '<div class="status warning">‚ö†Ô∏è This means config was not loaded (neither local nor injected by GitHub Actions)</div>';
                html += '<h3>Troubleshooting:</h3>';
                html += '<ol>';
                html += '<li>Check if you\'re testing locally - you need config.local.js file</li>';
                html += '<li>Check GitHub Actions deployment logs</li>';
                html += '<li>Verify GitHub Secrets are set: <a href="https://github.com/Kamo-Lyime/Nrome/settings/secrets/actions" target="_blank">Repository Secrets</a></li>';
                html += '</ol>';
            }
            
            // Check current URL
            html += '<h3>Environment Info:</h3>';
            html += '<div class="status">üìç Current URL: ' + window.location.href + '</div>';
            html += '<div class="status">üåê Protocol: ' + window.location.protocol + '</div>';
            html += '<div class="status">üñ•Ô∏è Hostname: ' + window.location.hostname + '</div>';
            
            if (window.location.hostname === 'kamo-lyime.github.io') {
                html += '<div class="status warning">‚ö†Ô∏è You are on GitHub Pages - config should be injected by GitHub Actions</div>';
            } else if (window.location.protocol === 'file:') {
                html += '<div class="status warning">‚ö†Ô∏è You are viewing from file:// - config.local.js won\'t load (use a web server)</div>';
            } else {
                html += '<div class="status success">‚úÖ You are on a local web server - config.local.js should work</div>';
            }
            
            results.innerHTML = html;
        }, 1000);
    </script>
</body>
</html>
