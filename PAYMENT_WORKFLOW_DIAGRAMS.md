# Payment Integration Visual Workflow

## ğŸ¨ AI Appointment Booking Flow with Paystack

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                  PATIENT BOOKING JOURNEY                      â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

1. OPEN MODAL
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Click "AI Booking"  â”‚
   â”‚  Card on nurse.html  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
2. FILL PATIENT INFO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Name: John Doe       â”‚
   â”‚ Email: john@mail.com â”‚â† REQUIRED for Paystack!
   â”‚ Phone: +27123456789  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
3. SELECT PRACTITIONER & TIME
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Practitioner: Dr XYZ â”‚
   â”‚ Date: 2026-01-30     â”‚
   â”‚ Time: 10:00 AM       â”‚
   â”‚ Reason: Headache     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
4. AI RECOMMENDATIONS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ¤– AI suggests:      â”‚
   â”‚ - Best time slot     â”‚
   â”‚ - Matched specialist â”‚
   â”‚ - Urgency level      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
5. CLICK "CONFIRM BOOKING & PAY"
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ’³ Payment Required            â”‚
   â”‚                                â”‚
   â”‚ Consultation Fee: R500         â”‚
   â”‚ - Practitioner: R400 (80%)     â”‚
   â”‚ - Platform: R100 (20%)         â”‚
   â”‚                                â”‚
   â”‚ Cancellation Policy:           â”‚
   â”‚ - Cancel â‰¥24h: Full refund     â”‚
   â”‚ - Cancel <24h: No refund       â”‚
   â”‚ - No-show: No refund           â”‚
   â”‚                                â”‚
   â”‚      [OK]      [Cancel]        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ [Patient clicks OK]
                â–¼
6. DATABASE: CREATE APPOINTMENT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ saveAppointmentWithPayment()   â”‚
   â”‚                                â”‚
   â”‚ INSERT INTO appointments       â”‚
   â”‚ {                              â”‚
   â”‚   booking_id: "APT-123456"     â”‚
   â”‚   status: "PENDING_PAYMENT"    â”‚
   â”‚   patient_email: "john@..."    â”‚
   â”‚   consultation_fee: 500        â”‚
   â”‚   payment_status: "UNPAID"     â”‚
   â”‚ }                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
7. PAYSTACK PAYMENT MODAL
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚     ğŸ’³ Paystack Secure Pay     â”‚
   â”‚                                â”‚
   â”‚ Email: john@mail.com           â”‚
   â”‚ Amount: R500.00                â”‚
   â”‚                                â”‚
   â”‚ Card Number:                   â”‚
   â”‚ [4084 0840 8408 4081]          â”‚
   â”‚                                â”‚
   â”‚ Expiry:  CVV:                  â”‚
   â”‚ [12/27]  [123]                 â”‚
   â”‚                                â”‚
   â”‚        [Pay R500.00]           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€[SUCCESS]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                        â”‚
                â–¼                        â”‚
8. PAYMENT SUCCESS CALLBACK            â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚ updateAppointmentAfterPayment()â”‚  â”‚
   â”‚                                â”‚  â”‚
   â”‚ UPDATE appointments SET        â”‚  â”‚
   â”‚   status = "PENDING_CONFIRM"   â”‚  â”‚
   â”‚   payment_status = "PAID"      â”‚  â”‚
   â”‚   payment_reference = "ref123" â”‚  â”‚
   â”‚   payment_date = NOW()         â”‚  â”‚
   â”‚                                â”‚  â”‚
   â”‚ INSERT INTO payment_trans...   â”‚  â”‚
   â”‚   amount = 50000 (kobo)        â”‚  â”‚
   â”‚   status = "SUCCESS"           â”‚  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚                      â”‚
                â–¼                      â”‚
9. SUCCESS MESSAGE                     â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚ âœ… PAYMENT SUCCESSFUL!         â”‚  â”‚
   â”‚    Appointment Booked!         â”‚  â”‚
   â”‚                                â”‚  â”‚
   â”‚ Booking ID: APT-123456         â”‚  â”‚
   â”‚ Payment Ref: pay_abc123xyz     â”‚  â”‚
   â”‚ Amount Paid: R500              â”‚  â”‚
   â”‚                                â”‚  â”‚
   â”‚ Patient: John Doe              â”‚  â”‚
   â”‚ Practitioner: Dr. XYZ          â”‚  â”‚
   â”‚ Date: Jan 30, 2026 at 10:00 AM â”‚  â”‚
   â”‚                                â”‚  â”‚
   â”‚ Status: â³ Awaiting Confirm    â”‚  â”‚
   â”‚ The practitioner has 24 hours  â”‚  â”‚
   â”‚ to confirm. If not confirmed,  â”‚  â”‚
   â”‚ you'll receive automatic refundâ”‚  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚                      â”‚
                â–¼                      â”‚
10. PRACTITIONER CONFIRMATION          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
    â”‚ Practitioner Reviews â”‚          â”‚
    â”‚   (24 hour window)   â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
           â”‚                          â”‚
           â”œâ”€[CONFIRMS]â”€â”€â”€â”€â”€â”€â”€â”       â”‚
           â”‚                  â”‚       â”‚
           â–¼                  â”‚       â”‚
    Status: CONFIRMED         â”‚       â”‚
    Patient notified          â”‚       â”‚
                              â”‚       â”‚
           â”œâ”€[TIMEOUT]â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
           â”‚                          â”‚
           â–¼                          â”‚
    AUTO-REFUND INITIATED             â”‚
    Status: REFUNDED                  â”‚
    Patient gets R500 back            â”‚
                                      â”‚
                â”œâ”€[CANCEL]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         [PAYMENT FAILED]
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ deletePendingAppointment()     â”‚
   â”‚                                â”‚
   â”‚ DELETE FROM appointments       â”‚
   â”‚ WHERE id = "..."               â”‚
   â”‚                                â”‚
   â”‚ âŒ Payment Cancelled           â”‚
   â”‚ Your appointment has not       â”‚
   â”‚ been booked.                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Appointment Management Flow

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                MY APPOINTMENTS DASHBOARD                      â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

1. OPEN MY APPOINTMENTS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ğŸ“… My Appointments                                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  Booking ID  â”‚ Practitioner â”‚ Date/Time â”‚ Status  â”‚ $  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
   â”‚  APT-123456  â”‚ Dr. XYZ      â”‚ Jan 30    â”‚ PENDING â”‚R500â”‚
   â”‚              â”‚              â”‚ 10:00 AM  â”‚ CONFIRM â”‚    â”‚
   â”‚              [ğŸ‘ï¸View] [ğŸ“…Reschedule] [âŒCancel]        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
   â”‚  APT-123457  â”‚ Dr. ABC      â”‚ Feb 1     â”‚CONFIRMEDâ”‚R500â”‚
   â”‚              â”‚              â”‚ 2:00 PM   â”‚         â”‚    â”‚
   â”‚              [ğŸ‘ï¸View] [ğŸ“…Reschedule] [âŒCancel]        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. CANCEL APPOINTMENT (Patient Initiated)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Cancel Appointment?                       â”‚
   â”‚                                            â”‚
   â”‚  Appointment: Dr. XYZ                      â”‚
   â”‚  Date: Jan 30, 2026 at 10:00 AM            â”‚
   â”‚                                            â”‚
   â”‚  Time until appointment: 36 hours          â”‚
   â”‚                                            â”‚
   â”‚  Refund Policy:                            â”‚
   â”‚  âœ… Full refund (R500)                     â”‚
   â”‚  Cancelled â‰¥24h before appointment         â”‚
   â”‚                                            â”‚
   â”‚  Reason: [Enter reason here...]            â”‚
   â”‚                                            â”‚
   â”‚       [Proceed]      [Go Back]             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ [Patient clicks Proceed]
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  cancelAppointment()                       â”‚
   â”‚                                            â”‚
   â”‚  IF hoursUntil >= 24:                      â”‚
   â”‚    - UPDATE status = "CANCELLED"           â”‚
   â”‚    - SET refund_status = "PENDING"         â”‚
   â”‚    - CALL paystack.initiateRefund()        â”‚
   â”‚    - Refund R500 to patient                â”‚
   â”‚  ELSE:                                     â”‚
   â”‚    - UPDATE status = "CANCELLED"           â”‚
   â”‚    - SET refund_status = "NOT_ELIGIBLE"    â”‚
   â”‚    - No refund (fee retained)              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  âœ… Appointment Cancelled                  â”‚
   â”‚                                            â”‚
   â”‚  A refund of R500 will be processed        â”‚
   â”‚  within 5-7 business days.                 â”‚
   â”‚                                            â”‚
   â”‚  Payment Reference: pay_abc123xyz          â”‚
   â”‚  Refund will appear in your account        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. RESCHEDULE APPOINTMENT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Reschedule Appointment                    â”‚
   â”‚                                            â”‚
   â”‚  Current: Jan 30, 2026 at 10:00 AM         â”‚
   â”‚                                            â”‚
   â”‚  New Date: [Feb 5, 2026    â–¼]              â”‚
   â”‚  New Time: [2:00 PM        â–¼]              â”‚
   â”‚                                            â”‚
   â”‚  Note: Practitioner must re-confirm        â”‚
   â”‚  new time. No additional payment needed.   â”‚
   â”‚                                            â”‚
   â”‚       [Confirm]      [Cancel]              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ [Patient clicks Confirm]
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  rescheduleAppointment()                   â”‚
   â”‚                                            â”‚
   â”‚  UPDATE appointments SET                   â”‚
   â”‚    appointment_date = "2026-02-05"         â”‚
   â”‚    appointment_time = "14:00"              â”‚
   â”‚    status = "PENDING_CONFIRMATION"         â”‚
   â”‚    rescheduled_at = NOW()                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  âœ… Appointment Rescheduled                â”‚
   â”‚                                            â”‚
   â”‚  New Date: Feb 5, 2026                     â”‚
   â”‚  New Time: 2:00 PM                         â”‚
   â”‚                                            â”‚
   â”‚  The practitioner will confirm the         â”‚
   â”‚  new time within 24 hours.                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Refund Decision Tree

```
                    REFUND REQUEST
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
    WHO CANCELS?    WHO CANCELS?    NO-SHOW?
         â”‚               â”‚               â”‚
    PATIENT        PRACTITIONER         YES
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
   WHEN CANCELLED?   ANYTIME        NO REFUND
         â”‚           REFUND          Fee Retained
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”         R500        Status: NO_SHOW
    â”‚         â”‚
  â‰¥24h     <24h
   â”‚         â”‚
   â–¼         â–¼
FULL      NO REFUND
REFUND    Fee Retained
R500      Status: CANCELLED

TIMEOUT (24h)?
    â”‚
    â–¼
Practitioner didn't confirm
    â”‚
    â–¼
FULL REFUND
R500
Status: REFUNDED
```

---

## ğŸ“Š Status State Machine

```
              START
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PENDING_PAYMENTâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚          â”‚
     PAID    TIMEOUT    CANCELLED
        â”‚       â”‚          â”‚
        â–¼       â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   DELETE
â”‚PENDING_CONFIRM   â”‚   APPOINTMENT
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â”€[Practitioner Confirms]â”€â”€â”€â”€â”€â”€â”
      â”‚                                â”‚
      â–¼                                â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
 â”‚CONFIRMEDâ”‚                           â”‚
 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                           â”‚
      â”‚                                â”‚
      â”œâ”€â”€[Appointment Occurs]â”€â”€â”       â”‚
      â”‚                        â”‚       â”‚
      â–¼                        â”‚       â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
 â”‚COMPLETEDâ”‚                   â”‚       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚       â”‚
                               â”‚       â”‚
      â”œâ”€â”€[Patient Cancels]â”€â”€â”€â”€â”€â”¤       â”‚
      â”‚                        â”‚       â”‚
      â–¼                        â”‚       â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚       â”‚
 â”‚CANCELLED â”‚                  â”‚       â”‚
 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚       â”‚
      â”‚                        â”‚       â”‚
      â”œâ”€â”€[Refund?]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
      â”‚                        â”‚       â”‚
      â–¼                        â”‚       â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚       â”‚
 â”‚REFUNDED â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[24h Timeout]
      â–²
      â”‚
      â””â”€â”€[No-Show]â”€â”€â”€â”€â”
                      â”‚
                 â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                 â”‚ NO_SHOW â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SECURITY ARCHITECTURE              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 1: EMAIL VALIDATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Patient enters     â”‚
â”‚ email address      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Regex validation:  â”‚
â”‚ /^[^\s@]+@...$/    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    [Valid?]
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   YES       NO
    â”‚         â”‚
    â–¼         â–¼
 PROCEED   REJECT
           "Invalid email"

LAYER 2: PAYSTACK PCI-DSS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Card details       â”‚
â”‚ entered in         â”‚
â”‚ Paystack iframe    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Paystack processes â”‚
â”‚ - No card data     â”‚
â”‚   stored locally   â”‚
â”‚ - PCI-DSS Level 1  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Payment Reference
    Stored in DB

LAYER 3: ROW LEVEL SECURITY (RLS)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Patient queries appointments:  â”‚
â”‚ SELECT * FROM appointments     â”‚
â”‚ WHERE user_id = ?              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase RLS Policy:           â”‚
â”‚ CREATE POLICY patient_own      â”‚
â”‚   ON appointments              â”‚
â”‚   FOR SELECT                   â”‚
â”‚   USING (auth.uid() = user_id) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
      Only sees own data!

LAYER 4: STATUS VALIDATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Patient tries to cancel:       â”‚
â”‚ cancelAppointment(id)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check current status:          â”‚
â”‚ IF status IN (                 â”‚
â”‚   'PENDING_PAYMENT',           â”‚
â”‚   'PENDING_CONFIRMATION',      â”‚
â”‚   'CONFIRMED'                  â”‚
â”‚ ) THEN allow_cancel()          â”‚
â”‚ ELSE reject()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± UI Components

```
NURSE.HTML UI STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         NROME LOGO (Top)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  African Medical Practitioners      â”‚
â”‚  [Description text...]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ’³   â”‚  ğŸ“…AI  â”‚  ğŸ¤–    â”‚  ğŸ¤    â”‚
â”‚ Book & â”‚Appoint â”‚Medical â”‚ Voice  â”‚
â”‚  Pay   â”‚ Bookingâ”‚Assistantâ”‚Scribe â”‚
â”‚ R500   â”‚ Smart  â”‚ 24/7   â”‚  AI    â”‚
â”‚[Button]â”‚[Button]â”‚[Button]â”‚[Button]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“‹   â”‚   ğŸ“…   â”‚
â”‚ Smart  â”‚   My   â”‚
â”‚ Triage â”‚Appoint.â”‚â† NEW!
â”‚  AI    â”‚ Manage â”‚
â”‚[Button]â”‚[Button]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’Š Order Medication Home Delivery  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  + Register Your Medical Practice   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  All Registered Practitioners       â”‚
â”‚  [Cards with practitioner info...]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

For implementation details, see: `AI_APPOINTMENT_PAYMENT_INTEGRATION.md`
